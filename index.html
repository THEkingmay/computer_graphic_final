<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>May3</title>
<style>
    body { margin: 0; overflow: hidden; background: #ffffff; }
    canvas { display: block; }
</style>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<script>
let scene, camera, renderer, controls;
let moveToPosition = {
  camera: new THREE.Vector3(0, -3, 15),
  target: new THREE.Vector3(0, 0, 0)
};
// ------------------ Raycaster ------------------
const raycaster = new THREE.Raycaster();
const pointer = new THREE.Vector2();

let clickableObj = [];
let cameraPosition = new THREE.Vector3(10, 20, 24);
let controlsPosition = new THREE.Vector3(0, 0, 0);

// ------------------ Scene / Camera / Renderer ------------------
function createScene() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);
}

function createCamera() {
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.copy(cameraPosition);
}

function createRenderer() {
    renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    document.body.appendChild(renderer.domElement);
}


// ------------------ Controls ------------------
function createControls() {
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    // controls.minPolarAngle = Math.PI / 10;        
    // controls.maxPolarAngle = Math.PI / 1.10;
    // controls.minAzimuthAngle = -Infinity;
    // controls.maxAzimuthAngle = Infinity;
    controls.enableDamping = true;
    controls.enableZoom = false;
    controls.enablePan = false;
}


function createRoom(size, zPos, color) {
  const roomGeo = new THREE.BoxGeometry(size , size , size);
  const roomMat = new THREE.MeshStandardMaterial({ 
    color: color,
    side: THREE.BackSide // กล้องอยู่ข้างในกล่อง
  });
  const room = new THREE.Mesh(roomGeo, roomMat);
  room.receiveShadow = true;
  room.castShadow = true
  room.position.z = zPos;
  scene.add(room);
}

// ------------------ Resize ------------------
function handleResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

// ------------------ Update Camera ------------------
function updateCamera() {
    // if(!moveToPosition) return
    camera.position.lerp(moveToPosition.camera, 0.02);
    controls.target.lerp(moveToPosition.target, 0.02);
    // console.log(moveToPosition , camera.position)
    // if (camera.position.distanceTo(moveToPosition.camera) < 2) {
    //   camera.position.copy(moveToPosition.camera);
    //    if (controls.target.distanceTo(moveToPosition.target) < 2) {
    //     controls.target.copy(moveToPosition.target);
    //     moveToPosition = null
    //    } 
    // }
    controls.update();
}

function setPointer(e) {
    const r = renderer.domElement.getBoundingClientRect();
    const x = (e.clientX ?? e.touches[0].clientX) - r.left;
    const y = (e.clientY ?? e.touches[0].clientY) - r.top;
    pointer.x = (x / r.width) * 2 - 1;
    pointer.y = -(y / r.height) * 2 + 1;
}

function onPick(e) {
    setPointer(e);
    // console.log('test')
    raycaster.setFromCamera(pointer, camera);
    const hit = raycaster.intersectObjects(clickableObj, true)[0]; // true รวม child
    if (!hit) return;
    // console.log(hit)
    if (hit.object.name === "getStarted") {
      
        // console.log("hit")
        // กำหนดกล้องไปข้างหลังและสูงขึ้นจาก target
        moveToPosition = {
            camera: new THREE.Vector3(0, 0, -40),
            target: new THREE.Vector3(0, 0 , -40)
        };
    }
}

// ------------------ Animate ------------------
function animate(t) {
    requestAnimationFrame(animate);
    updateCamera();
    controls.update();



    renderer.render(scene, camera);
}

function Room1(){
  createRoom(40,0, 0xdddddd); 
  const loader = new THREE.FontLoader();
  loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', font => {
        const textGeo = new THREE.TextGeometry("Hi , Welcome to my site", {
            font: font,
            size: 1,
            height: 0.2,
            curveSegments: 12,
        });
        textGeo.center();
        const textMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const textMesh = new THREE.Mesh(textGeo, textMat);
        textMesh.position.y = 1;
        textMesh.castShadow = true;
        scene.add(textMesh);
    });
    loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', font => {
        const startGeo = new THREE.TextGeometry("Get Started >", {
            font: font,
            size: 0.6,
            height: 0.1,
            curveSegments: 12,
        });
        startGeo.center();
        const startMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const startMesh = new THREE.Mesh(startGeo, startMat);
        startMesh.position.y = -1.5;
        startMesh.name = "getStarted";
        startMesh.castShadow = true;
        clickableObj.push(startMesh);
        scene.add(startMesh);
    });
const roomLight = new THREE.SpotLight(0xffffff, 1, 30); // intensity ลดจาก 1.5 → 0.5
roomLight.position.set(0, 0,15);
roomLight.castShadow = true;
roomLight.distance = 45; // ลดระยะให้แสงไม่ไกลเกิน
roomLight.angle = Math.PI / 6; // กำหนดมุมกรวยแสง ถ้าต้องการ
roomLight.penumbra = 0.3;    // ลดขอบแสงให้ดูนุ่ม
roomLight.shadow.mapSize.width = 1024;
roomLight.shadow.mapSize.height = 1024;

scene.add(roomLight);
//     const spotHelper = new THREE.SpotLightHelper(roomLight, 0xffff00); // สีเหลือง
// scene.add(spotHelper);
}
function Room2(){
    createRoom(3,-40, 0x444444); 
    const roomLight = new THREE.PointLight(0xffffff, 1.5, 30); // intensity ลดจาก 1.5 → 0.5
    roomLight.position.set(0,0.5,-40)
    scene.add(roomLight)
} 
// ------------------ Main ------------------
function main() {
    createScene();
    createCamera();
    createRenderer();
    createControls();
    Room1()
    Room2()
    renderer?.domElement.addEventListener('click', onPick);
    renderer?.domElement.addEventListener('touchend', (e) => { onPick(e); });
    window.addEventListener('resize', handleResize);
    animate();
}

main();
</script>
</body>
</html>
